---
import { getCollection } from 'astro:content';
import BaseLayout from '@layouts/BaseLayout.astro';
import CityCard from '@components/CityCard.astro';
import ClinicCard from '@components/ClinicCard.astro';

const allCities = await getCollection('cities');
const allClinics = await getCollection('clinics');

// Count clinics per city
const clinicCounts = new Map<string, number>();
for (const clinic of allClinics) {
  const city = clinic.data.city;
  clinicCounts.set(city, (clinicCounts.get(city) || 0) + 1);
}

// Featured clinics
const featuredClinics = allClinics
  .filter((c) => c.data.featured)
  .sort((a, b) => b.data.rating - a.data.rating)
  .slice(0, 3);
---

<BaseLayout
  title="Find Top Plastic Surgery Clinics | Aesthetic Surgery Journal"
  description="Browse our directory of board-certified plastic surgery clinics. Compare ratings, read patient reviews, and find the best surgeons near you."
>
  <!-- Hero Section -->
  <section class="bg-ivory">
    <div class="mx-auto max-w-7xl px-6 py-16 md:py-24 lg:px-10">
      <div class="animate-on-scroll mx-auto max-w-3xl text-center">
        <p class="mb-4 text-xs font-medium uppercase tracking-[0.2em] text-rose-gold">
          Clinic Directory
        </p>
        <h1 class="font-serif text-4xl font-medium leading-[1.1] text-charcoal md:text-5xl lg:text-6xl">
          Find the <span class="italic text-rose-gold-dark">right surgeon</span> for you
        </h1>
        <p class="mt-6 text-lg leading-relaxed text-charcoal/60">
          Browse our curated directory of board-certified plastic surgery clinics.
          Every listing is verified for credentials, accreditation, and patient satisfaction.
        </p>
      </div>

      <!-- Trust indicators -->
      <div class="animate-on-scroll stagger-1 mt-10 flex flex-wrap items-center justify-center gap-8">
        <div class="flex items-center gap-2">
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-deep-sage/10">
            <svg class="h-4 w-4 text-deep-sage" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75m-3-7.036A11.959 11.959 0 013.598 6 11.99 11.99 0 003 9.749c0 5.592 3.824 10.29 9 11.623 5.176-1.332 9-6.03 9-11.622 0-1.31-.21-2.571-.598-3.751h-.152c-3.196 0-6.1-1.248-8.25-3.285z" />
            </svg>
          </div>
          <span class="text-xs font-medium text-charcoal/50">Verified Clinics</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-soft-navy/10">
            <svg class="h-4 w-4 text-soft-navy" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.562.562 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.562.562 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
            </svg>
          </div>
          <span class="text-xs font-medium text-charcoal/50">Patient Reviews</span>
        </div>
        <div class="flex items-center gap-2">
          <div class="flex h-8 w-8 items-center justify-center rounded-full bg-rose-gold/10">
            <svg class="h-4 w-4 text-rose-gold" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4.26 10.147a60.438 60.438 0 00-.491 6.347A48.62 48.62 0 0112 20.904a48.62 48.62 0 018.232-4.41 60.46 60.46 0 00-.491-6.347m-15.482 0a50.636 50.636 0 00-2.658-.813A59.906 59.906 0 0112 3.493a59.903 59.903 0 0110.399 5.84c-.896.248-1.783.52-2.658.814m-15.482 0A50.717 50.717 0 0112 13.489a50.702 50.702 0 017.74-3.342" />
            </svg>
          </div>
          <span class="text-xs font-medium text-charcoal/50">Board Certified</span>
        </div>
      </div>
    </div>
    <div class="h-px bg-gradient-to-r from-transparent via-warm-sand/60 to-transparent"></div>
  </section>

  <!-- Browse by City -->
  <section class="bg-white py-16 md:py-24">
    <div class="mx-auto max-w-7xl px-6 lg:px-10">
      <div class="animate-on-scroll mb-10">
        <p class="mb-2 text-xs font-medium uppercase tracking-[0.2em] text-rose-gold">
          Browse by Location
        </p>
        <h2 class="font-serif text-3xl font-medium text-charcoal md:text-4xl">
          Top cities
        </h2>
        <p class="mt-3 max-w-lg text-sm leading-relaxed text-charcoal/50">
          Explore clinics in the most sought-after destinations for plastic surgery.
        </p>
      </div>
      <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
        {allCities.map((city, i) => (
          <div class={`animate-on-scroll stagger-${(i % 4) + 1}`}>
            <CityCard
              name={city.data.name}
              state={city.data.state}
              slug={city.data.slug}
              clinicCount={clinicCounts.get(city.data.slug) || 0}
              description={city.data.description}
              coverImage={city.data.coverImage}
            />
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Featured Clinics -->
  {featuredClinics.length > 0 && (
    <section class="bg-ivory py-16 md:py-24">
      <div class="mx-auto max-w-7xl px-6 lg:px-10">
        <div class="animate-on-scroll mb-10">
          <p class="mb-2 text-xs font-medium uppercase tracking-[0.2em] text-rose-gold">
            Featured
          </p>
          <h2 class="font-serif text-3xl font-medium text-charcoal md:text-4xl">
            Top-rated clinics
          </h2>
          <p class="mt-3 max-w-lg text-sm leading-relaxed text-charcoal/50">
            Highly rated practices chosen for their exceptional patient care and surgical outcomes.
          </p>
        </div>
        <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
          {featuredClinics.map((clinic, i) => (
            <div class={`animate-on-scroll stagger-${(i % 4) + 1}`}>
              <ClinicCard
                name={clinic.data.name}
                slug={clinic.data.slug}
                citySlug={clinic.data.city}
                address={clinic.data.address}
                phone={clinic.data.phone}
                rating={clinic.data.rating}
                reviewCount={clinic.data.reviewCount}
                specialties={clinic.data.specialties}
                description={clinic.data.description}
                verified={clinic.data.verified}
                featured={clinic.data.featured}
              />
            </div>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Trust Section -->
  <section class="bg-white py-16 md:py-24">
    <div class="mx-auto max-w-7xl px-6 lg:px-10">
      <div class="animate-on-scroll rounded-3xl bg-gradient-to-br from-charcoal to-soft-navy p-10 md:p-16">
        <div class="grid items-center gap-10 lg:grid-cols-2 lg:gap-16">
          <div>
            <p class="mb-3 text-xs font-medium uppercase tracking-[0.2em] text-rose-gold">
              Why Our Directory
            </p>
            <h2 class="font-serif text-3xl font-medium text-white md:text-4xl">
              Choose with confidence
            </h2>
            <p class="mt-4 text-base leading-relaxed text-white/60">
              Every clinic in our directory is verified for board certification, accreditation,
              and patient satisfaction. We believe finding the right surgeon should be
              transparent and straightforward.
            </p>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div class="rounded-2xl bg-white/5 p-6 backdrop-blur-sm">
              <p class="font-serif text-3xl font-medium text-rose-gold">100%</p>
              <p class="mt-1 text-xs text-white/50">Verified credentials</p>
            </div>
            <div class="rounded-2xl bg-white/5 p-6 backdrop-blur-sm">
              <p class="font-serif text-3xl font-medium text-rose-gold">Real</p>
              <p class="mt-1 text-xs text-white/50">Patient reviews</p>
            </div>
            <div class="rounded-2xl bg-white/5 p-6 backdrop-blur-sm">
              <p class="font-serif text-3xl font-medium text-rose-gold">ABPS</p>
              <p class="mt-1 text-xs text-white/50">Board certified only</p>
            </div>
            <div class="rounded-2xl bg-white/5 p-6 backdrop-blur-sm">
              <p class="font-serif text-3xl font-medium text-rose-gold">Free</p>
              <p class="mt-1 text-xs text-white/50">No hidden fees</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
